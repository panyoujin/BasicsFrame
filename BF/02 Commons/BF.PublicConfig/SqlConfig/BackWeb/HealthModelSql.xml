<?xml version="1.0" encoding="utf-8" ?>
<HCIP.AjaxDataSetting>

  <!--通过类型获取养生模式-->
  <Data name="BackWeb_GetHealthModelListByType">
    <SqlDefinition type="sql">
      <SqlCommand>
        <![CDATA[
        SELECT `ID` AS MID,Introduce,Model_Name,IcoUrl,ImageUrl,Sort FROM `TB_MB_Models` WHERE `Status` AND Model_Type = @@Model_Type@@ order BY Sort DESC <%= LIMIT @@StartSize@@ , @@PageSize@@%>;
      ]]>
      </SqlCommand>
    </SqlDefinition>
  </Data>
  <!--根据模式ID 获取模式，需要检验当前用户是否有权限访问该模式-->
  <Data name="BackWeb_GetHealthModelInfoByModelID">
    <SqlDefinition type="sql">
      <SqlCommand>
        <![CDATA[
        SELECT  `ID` AS MID, `User_ID`, `Model_Name`, `IcoUrl`, `ImageUrl`, `Introduce`, `Describe`, `Remarks`, `Sort`, `IsBubble`, `Bubble_Time`, `Bubble_Temperature`
        , `Cook_Time`, `Cook_Temperature`, `Is_Heat_Preservation`, `Heat_Preservation_Time`, `Heat_Preservation_Temperature`, `Removal_Chlorine_Time`
        , `Final_Temperature`, `IsFerv`, `Model_Type`, `Model_Status`
        FROM `TB_MB_Models` WHERE `Status` AND ID=@@ModelID@@ <%= AND (Model_Type=0 OR (Model_Type=1 AND User_ID=@@User_ID@@)) %>;
      ]]>
      </SqlCommand>
    </SqlDefinition>
  </Data>
  <!--新增模式-->
  <Data name="BackWeb_AddHealthModel">
    <SqlDefinition type="sql">
      <SqlCommand>
        <![CDATA[
        INSERT INTO `TB_MB_Models` (
        `User_ID`,`Model_Name`,`IcoUrl`,`ImageUrl`,`Introduce`,`Describe`,`Remarks`,`Sort`,`IsBubble`,
        `Bubble_Time`,`Bubble_Temperature`,`Cook_Time`,`Cook_Temperature`,`Is_Heat_Preservation`,`Heat_Preservation_Time`,`Heat_Preservation_Temperature`,
        `Removal_Chlorine_Time`,`Final_Temperature`,`IsFerv`,`Model_Type`,`Model_Status`,`CreationUser`,`CreationDate`) 
        VALUES(
        @@User_ID@@, @@Model_Name@@, @@IcoUrl@@, @@ImageUrl@@, @@Introduce@@, @@Describe@@, @@Remarks@@, @@Sort@@, @@IsBubble@@
        , @@Bubble_Time@@,@@Bubble_Temperature@@,@@Cook_Time@@,@@Cook_Temperature@@,@@Is_Heat_Preservation@@,@@Heat_Preservation_Time@@,@@Heat_Preservation_Temperature@@,
        @@Removal_Chlorine_Time@@,@@Final_Temperature@@,@@IsFerv@@,@@Model_Type@@,@@Model_Status@@,'@@CreationUser@@',NOW()
        );
      ]]>
      </SqlCommand>
    </SqlDefinition>
  </Data>
  <!--设置常用模式-->
  <Data name="BackWeb_SetCommonModel">
    <SqlDefinition type="sql">
      <SqlCommand>
        <![CDATA[
        UPDATE TB_MB_CommonModel SET `Status`=TRUE,`ModificationUser`=@@UserAccount@@,`ModificationDate`=NOW() WHERE User_ID=@@User_ID@@ AND Model_ID = @@ModelID@@;
        INSERT INTO `TB_MB_CommonModel` (`User_ID`,`Model_ID`,`CreationDate`,`CreationUser`) 
        SELECT @@User_ID@@,@@ModelID@@,now(),@@UserAccount@@
        FROM `TB_MB_MemberInfo` WHERE NOT EXISTS (SELECT ID FROM TB_MB_CommonModel WHERE User_ID=@@User_ID@@ and Model_ID = @@ModelID@@ and `Status`=TRUE)
        AND EXISTS (SELECT ID FROM `TB_MB_Models` WHERE `ID`=@@ModelID@@ AND `Status`=TRUE)LIMIT 0,1;
      ]]>
      </SqlCommand>
    </SqlDefinition>
  </Data>
  <!--取消常用模式-->
  <Data name="BackWeb_CancelCommonModel">
    <SqlDefinition type="sql">
      <SqlCommand>
        <![CDATA[
        UPDATE TB_MB_CommonModel SET `Status`=FALSE,`ModificationUser`=@@UserAccount@@,`ModificationDate`=NOW() WHERE User_ID=@@User_ID@@ AND Model_ID = @@ModelID@@;
      ]]>
      </SqlCommand>
    </SqlDefinition>
  </Data>

  <!--获取常用养生模式列表-->
  <Data name="BackWeb_GetCommonHealthModelList">
    <SqlDefinition type="sql">
      <SqlCommand>
        <![CDATA[
        SELECT m.`ID` AS MID,m.Introduce,m.Model_Name,m.IcoUrl,m.ImageUrl,m.Sort 
        FROM `TB_MB_CommonModel` AS cm
        JOIN `TB_MB_Models` AS m ON m.`ID`=cm.`Model_ID`
        WHERE cm.`User_ID`=@@User_ID@@ AND cm.`Status`=TRUE AND m.`Status`=TRUE ORDER BY m.Sort DESC,cm.`CreationDate` DESC;
      ]]>
      </SqlCommand>
    </SqlDefinition>
  </Data>
</HCIP.AjaxDataSetting>